---
title: "Project Dev Journal"
output: github_document
---

```{r setup, include=FALSE}
knitr::opts_chunk$set(eval = FALSE)

github_sha_link <- function(sha) {
  glue::glue(
    "([changelog: {substr(sha, 1, 6)}]",
    "(https://github.com/gadenbuie/js4shiny-drumkit/commit/{sha})"
  )
}
```

I've setup a basic [index.html](index.html) to get us started.

# Drumit: A Single Page App

## Add the drumkit image

Typically images are included in a page using the `<img>` tag.

Let's try that first

```html
<!-- PUT SVG HERE -->
<img src="drumkit.svg" />
```

This doesn't work the way we want.
Compare the [drumkit.svg](drumkit.svg) document
with what we see in the developer console.
The SVG document is XML (like HTML),
but uses a different set of tags.

In order to be able to access the structure of the SVG,
we need to drop the whole SVG into our HTML page.

## Change the drumkit's colors

I've include some styles in a `<style>` tag 
at the bottom of the page.
Use these to change the colors of the drumkit
and get a sense for the structure of the svg:

* Individual SVG elements: `polygon`, `path`, `ellipse`
* Each have classes: `.drum-side.kick`
* Are also grouped together, with ID for group: `#kick`
* Note that last class is the same as the sound we want to play: `class="drum-side kick"` means we should use a kick drum sound.

Here are suggestions for colors for the drumkit.

- black stands
- gray rims
- purple drums
- dark purple bottoms
- white kick front
- yellow symbols
- orange hover

Check out the hover effect!

## Try the playDrum() function

In the dev console, try running

```
playDrum('kick')
playDrum('snare')
```

## Find the drumkit and the text elements

First, find the DOM elements that we're going to want to use.

```js
// Find drumkit, hoverText, and clickText elements
const drumkit = document.getElementById('drumkit');
const hoverText = document.getElementById('hover-text');
const clickText = document.getElementById('click-text');
```

## Listen to mouseover events on the drumkit

This isn't strictly required to make the drumkit work,
but it gives us a chance to practice working with
browser events.

Add an event listener to the drumkit and output

- The name of the current moused-over tag

- The list of classes on that tag, separated by a dot.

Create the event listener first 
and just write the `event` object to the console. 

```{js}
drumkit.addEventListener('mouseover', function(event) {
  console.log(event)
})
```

Then use `event.target.tagname` and `event.target.classList`.

```{js}
drumkit.addEventListener('mouseover', function(event) {
  const tag = event.target.tagName
  let classes = event.target.classList
  classes = ['', ...classes]
  hoverText.textContent = tag + ' ' + classes.join('.')
})
```

Use the browser dev tools to examine the `<svg>` element.
You should see a small "event" box next to the slement in the DOM.
This tells you that there is an event listener
attached to this element and you can inspect
which events are being watched.

The browser will also highlight in the DOM tree any updates.
Watch the `<p>` element containing the hover text
to see how the browser alerts you to updates in the DOM.

## Add our click event listener

- Get the `.classList` of the `event.target`.

- Use `.length` to get the last class

- Write out the class to `console.log()`

- Confirm that it's working and then write to the click text element

## Make some noise!

Store the last class name as `drumPart`...

...and send it off to `playDrum()`.

_insert gif of animal: wipe out!_

## Rewrite event listener to listen on the document

Instead of listening for click events on `drumkit`,
rewrite the event listener to be attached to the `document`.

Use `element.match('selecter')` to only listen to clicks
on just elements that are

1. direct descendents of a `<g>` element (svg group)

1. which are direct descendents of an `<svg>` element

1. which has the id `.drumkit`.

<details><summary>A convoluted way of saying</summary>

```
svg.drumkit > g > *
```

</details>

You'll know it's working when it makes sound again.

<details><summary>Solution</summary>

```{js}
document.addEventListener('click', function(event) {
  const el = event.target
  if (!el.matches('svg#drumkit > g > *')) {
    // not an event we want to worry about
    return;
  }

  const classes = el.classList
  const drumPart = classes[classes.length -1]
  clickText.textContent = drumPart
  playDrum(drumPart)
})
```
</details>


# A Shiny Drumkit App

We're going to basically repeat the process again,
this time in Shiny.
(And we get to use what we've learned so far.)

## Create a skeleton Shiny app with a module

1. Create a bare bones Shiny app.
   The `shinyapp` snippet is helpful here.

2. Then make a bare bones Shiny module.
   Again, the `shinymod` snippet is helpful.
   Call the module `drumkitUI` and `drumkit`.
